(function(){Date.parseISO8601=function(a){var b,c,d,e,f,g,h;if(e=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/,!(d=e.exec(a)))return null;for(h=[1,4,5,6,7,10,11],f=0,g=h.length;g>f;f++)b=h[f],d[b]=+d[b]||0;return d[2]=(+d[2]||1)-1,d[3]=+d[3]||1,"Z"!==d[8]&&null!=d[9]&&(c=60*d[10]+d[11],"+"===d[9]&&(c=-c),d[5]+=c),new Date(Date.UTC.apply(Date,d.slice(1,8)))}}).call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.Schedule=function(){function b(c,d){this.toString=a(this.toString,this),this.toJSON=a(this.toJSON,this),this.toObject=a(this.toObject,this),this.suboccurrencesBetween=a(this.suboccurrencesBetween,this),this.occurrencesBetween=a(this.occurrencesBetween,this),this.occurrences=a(this.occurrences,this),this.previousOccurrence=a(this.previousOccurrence,this),this.nextOccurrence=a(this.nextOccurrence,this),this.first=a(this.first,this),this.setEndTime=a(this.setEndTime,this),this.rule=a(this.rule,this),this.setRule=a(this.setRule,this),null!=d&&(this.occurrence=new b.Occurrence(d,c)),this.startTime=this.occurrence?this.occurrence.startTime:c}return b.prototype.setRule=function(a){return this.occurrence=null!=a?null:new b.Occurrence(a,this.startTime),this.occurrence.duration=this.endTime?this.endTime-this.startTime:0},b.prototype.rule=function(){return null!=this.occurrence?this.occurrence.rule:null},b.prototype.setEndTime=function(a){if(a<this.startTime)throw"End time is before start time";return this.endTime=a,null!=this.occurrence&&(this.occurrence.duration=a-this.startTime),a},b.prototype.first=function(a){return null==this.occurrence?[this.startTime]:this.occurrence.nextOccurrences(a,this.startTime)},b.prototype.nextOccurrence=function(a){return null==this.occurrence?this.startTime<a?null:this.startTime:this.occurrence.nextOccurrence(a)},b.prototype.previousOccurrence=function(a){return null==this.occurrence?this.startTime>=a?null:this.startTime:this.occurrence.previousOccurrence(a)},b.prototype.occurrences=function(a){if(null==a&&this.occurrence&&this.occurrence.rule.isInfinite())throw"You have to specify end time for an infinite schedule occurrence listing";return null!=a?this.occurrencesBetween(this.startTime,a):null==this.occurrence?[this.startTime]:this.occurrence.all()},b.prototype.occurrencesBetween=function(a,b){return null==this.occurrence?this.startTime<a||this.startTime>=b?[]:[this.startTime]:this.occurrence.occurrencesBetween(a,b)},b.prototype.suboccurrencesBetween=function(a,c){if(null==this.endTime)throw"Schedule must have an end time to compute suboccurrences";return null==this.occurrence?[b.Suboccurrence.find({occurrence:[this.startTime,this.endTime],interval:[a,c]})]:this.occurrence.suboccurrencesBetween(a,c)},b.prototype.toObject=function(){var a;return a=null!=this.occurrence?this.occurrence.toObject():{},a.start=this.startTime,null!=this.endTime&&(a.end=this.endTime),a},b.prototype.toJSON=function(){return JSON.stringify(this.toObject())},b.prototype.toString=function(){return this.rule().toString()},b}(),Schedule.fromObject=function(a){var b,c,d,e;return e=a.start,b=a.end,c=a.freq&&a.interval?Schedule.Rule.fromObject(a):null,d=new Schedule(e,c),d.setEndTime(b),d},Schedule.fromJSON=function(a){var b;return b=JSON.parse(a),null!=b.start&&(b.start=Date.parseISO8601(b.start)),null!=b.end&&(b.end=Date.parseISO8601(b.end)),null!=b.stop&&(b.stop=Date.parseISO8601(b.stop)),Schedule.fromObject(b)},Schedule.Rules={},Schedule.Filters={}}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;Schedule.Rule=function(){function c(b){null==b&&(b=1),this._minStep=a(this._minStep,this),this._potentialPrevious=a(this._potentialPrevious,this),this._potentialNext=a(this._potentialNext,this),this.toString=a(this.toString,this),this.toJSON=a(this.toJSON,this),this.toObject=a(this.toObject,this),this.step=a(this.step,this),this.freq=a(this.freq,this),this.aligned=a(this.aligned,this),this.previous=a(this.previous,this),this.next=a(this.next,this),this.match=a(this.match,this),this.isInfinite=a(this.isInfinite,this),this.isFinite=a(this.isFinite,this),this.filters=a(this.filters,this),this.yearday=a(this.yearday,this),this.yeardays=a(this.yeardays,this),this.monthday=a(this.monthday,this),this.monthdays=a(this.monthdays,this),this.weekday=a(this.weekday,this),this.weekdays=a(this.weekdays,this),this.month=a(this.month,this),this.months=a(this.months,this),this.stop=a(this.stop,this),this.count=a(this.count,this),this.interval=b,this._filters=[],this._filterMap={}}return c.prototype.count=function(a){return a?(this._count=a,this):this._count},c.prototype.stop=function(a){return a?(this._stop=a,this):this._stop},c.prototype.months=function(){var a,c;if(c=1<=arguments.length?b.call(arguments,0):[],null!=this._filterMap.month)throw"Months filter already set";return a=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(Schedule.Filters.MonthsFilter,c,function(){}),this._filters.push(a),this._filterMap.months=a,this},c.prototype.month=function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],this.months.apply(this,a)},c.prototype.weekdays=function(){var a,c;if(c=1<=arguments.length?b.call(arguments,0):[],null!=this._filterMap.weekdays)throw"weekdays filter already set";return c=[this].concat(c),a=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(Schedule.Filters.WeekdaysFilter,c,function(){}),this._filters.push(a),this._filterMap.weekdays=a,this},c.prototype.weekday=function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],this.weekdays.apply(this,a)},c.prototype.monthdays=function(){var a,c;if(c=1<=arguments.length?b.call(arguments,0):[],null!=this._filterMap.monthdays)throw"monthdays filter already set";return a=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(Schedule.Filters.MonthdaysFilter,c,function(){}),this._filters.push(a),this._filterMap.monthdays=a,this},c.prototype.monthday=function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],this.monthdays.apply(this,a)},c.prototype.yeardays=function(){var a,c;if(c=1<=arguments.length?b.call(arguments,0):[],null!=this._filterMap.yeardays)throw"yeardays filter already set";return a=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(Schedule.Filters.YeardaysFilter,c,function(){}),this._filters.push(a),this._filterMap.yeardays=a,this},c.prototype.yearday=function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],a.apply(null,a)},c.prototype.filters=function(a){return null==a?this._filters:this._filterMap[a]},c.prototype.isFinite=function(){return null!=this.count()||null!=this.stop()},c.prototype.isInfinite=function(){return!this.isFinite()},c.prototype.match=function(a,b){var c,d,e,f;for(f=this._filters,d=0,e=f.length;e>d;d++)if(c=f[d],!c.match(a))return!1;return this.aligned(a,b)},c.prototype.next=function(a,b){var c,d,e,f;for(d=new Date(a),e=this._minStep(),c=1e3;!(this.match(d,b)&&d>a);){if(!(c-->0))throw"Maximum iterations reached when getting next rule occurrence...";f=this._align(this._potentialNext(d,b),b),Date.equals(f,d)&&f.add(e.length)[e.unit](),d=f}return d},c.prototype.previous=function(a,b){var c,d,e,f;for(d=new Date(a),e=this._minStep(),c=1e3;!(this.match(d,b)&&a>d);){if(!(c-->0))throw"Maximum iterations reached when getting previous occurrence...";f=this._align(this._potentialPrevious(d,b),b),Date.equals(f,d)&&f.add(-e.length)[e.unit](),d=f}return d},c.prototype.aligned=function(){},c.prototype.freq=function(){},c.prototype.step=function(){},c.prototype.toObject=function(){var a;return a={freq:this.freq(),interval:this.interval},null!=this.count()&&(a.count=this.count()),null!=this.stop()&&(a.stop=this.stop()),null!=this.filters("weekdays")&&(a.weekdays=this.filters("weekdays").weekdays.concat(this.filters("weekdays").orderedWeekdays)),null!=this.filters("monthdays")&&(a.monthdays=this.filters("monthdays").monthdays),null!=this.filters("yeardays")&&(a.yeardays=this.filters("yeardays").yeardays),null!=this.filters("months")&&(a.months=this.filters("months").months),a},c.prototype.toJSON=function(){return JSON.stringify(this.toObject())},c.prototype.toString=function(){var a,b,c;return a=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=[],this.filters("months")&&c.push(this.filters("months").toString()),this.filters("weekdays")&&c.push(this.filters("weekdays").toString()),this.filters("monthdays")&&c.push(this.filters("monthdays").toString()),this.filters("yeardays")&&c.push(this.filters("yeardays").toString()),this.count()&&c.push("end after "+this.count()+" times"),this.stop()&&c.push("until "+b[this.stop().getMonth()]+" "+this.stop().getDate()+", "+this.stop().getFullYear()),c.join(", ")},c.prototype._potentialNext=function(a){var b,c;return b=function(){var b,d,e,f;for(e=this.filters(),f=[],b=0,d=e.length;d>b;b++)c=e[b],f.push(c.next(a));return f}.call(this),b.length>0?new Date(Math.max.apply(Math,b)):a},c.prototype._potentialPrevious=function(a){var b,c;return b=function(){var b,d,e,f;for(e=this.filters(),f=[],b=0,d=e.length;d>b;b++)c=e[b],f.push(c.previous(a));return f}.call(this),b.length>0?new Date(Math.max.apply(Math,b)):a},c.prototype._align=function(){throw""+typeof this+".align should be overriden and return a time in the period of time parameter, aligned to base"},c.prototype._minStep=function(){var a,b,c,d,e;if(null!=this.__minStep)return this.__minStep;for(c=function(){var b,c,d,e;for(d=this.filters(),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.step());return e}.call(this),c.push(this.step()),this.__minStep=c[0],b=d=1,e=c.length;e>=1?e>d:d>e;b=e>=1?++d:--d)c[b].seconds<this.__minStep.seconds&&(this.__minStep=c[b]);return this.__minStep},c}(),Schedule.Rule.daily=function(a){return null==a&&(a=1),new Schedule.Rules.DailyRule(a)},Schedule.Rule.yearly=function(a){return null==a&&(a=1),new Schedule.Rules.YearlyRule(a)},Schedule.Rule.weekly=function(a){return null==a&&(a=1),new Schedule.Rules.WeeklyRule(a)},Schedule.Rule.monthly=function(a){return null==a&&(a=1),new Schedule.Rules.MonthlyRule(a)},Schedule.Rule.fromObject=function(a){var b;if(!a.freq||!a.interval)throw"Bad object format";return b=Schedule.Rule[a.freq](+a.interval),null!=a.count&&b.count(a.count),null!=a.stop&&b.stop(a.stop),null!=a.weekdays&&b.weekdays.apply(b,a.weekdays),null!=a.monthdays&&b.monthdays.apply(b,a.monthdays),null!=a.yeardays&&b.yeardays.apply(b,a.yeardays),null!=a.months&&b.months.apply(b,a.months),b},Schedule.Rule.fromJSON=function(a){var b;return b=JSON.parse(a),b.stop&&(b.stop=Date.parseISO8601(b.stop)),Schedule.Rule.fromObject(b)}}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Schedule.Rules.DailyRule=function(c){function e(){return this._align=b(this._align,this),this._potential_previous=b(this._potential_previous,this),this._potentialNext=b(this._potentialNext,this),this.toString=b(this.toString,this),this.step=b(this.step,this),this.freq=b(this.freq,this),this.aligned=b(this.aligned,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.aligned=function(a,b){var c;return c=[new Date(a),new Date(b)],a=c[0],b=c[1],0!==(new Date(b).at({hour:0,minute:0,second:0})-new Date(a).at({hour:0,minute:0,second:0}))%this.interval?!1:a.getHours()!==b.getHours()||a.getMinutes()!==b.getMinutes()||a.getSeconds()!==b.getSeconds()?!1:!0},e.prototype.freq=function(){return"daily"},e.prototype.step=function(){return{length:this.interval,unit:"days",seconds:86400*this.interval}},e.prototype.toString=function(){var a,b;return b=e.__super__.toString.call(this),a=this.interval>1?"Every "+this.interval+" days":"Daily",b&&(a+=", "+b),a},e.prototype._potentialNext=function(a,b){var c,d;return c=e.__super__._potentialNext.call(this,a,b),d=(new Date(b).at({hour:0,minute:0,second:0})-new Date(c).at({hour:0,minute:0,second:0}))%this.interval,0===d?c:new Date(c).add(d).days().at({hour:0,minute:0,second:0})},e.prototype._potential_previous=function(a,b){var c,d;return c=e.__super__._potential_previous.call(this,a,b),d=(new Date(b).at({hour:0,minute:0,second:0})-new Date(c).at({hour:0,minute:0,second:0}))%this.interval,0===d?c:new Date(c).add(d-this.interval).days().at({hour:0,minute:0})},e.prototype._align=function(a,b){return a=new Date(a).at({hour:0,minute:0,second:0}).add({hours:b.getHours(),minutes:b.getMinutes(),seconds:b.getSeconds()})},e}(Schedule.Rule)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Schedule.Rules.MonthlyRule=function(c){function e(){return this._monthdayFilters=b(this._monthdayFilters,this),this._align=b(this._align,this),this._potentialPrevious=b(this._potentialPrevious,this),this._potentialNext=b(this._potentialNext,this),this.toString=b(this.toString,this),this.step=b(this.step,this),this.freq=b(this.freq,this),this.aligned=b(this.aligned,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.aligned=function(a,b){return 0!==(12*b.getFullYear()+b.getMonth()-(12*a.getFullYear()+a.getMonth()))%this.interval?!1:a.getHours()!==b.getHours()||a.getMinutes()!==b.getMinutes()||a.getSeconds()!==b.getSeconds()?!1:b.getDate()===a.getDate()||this._monthdayFilters()?!0:!1},e.prototype.freq=function(){return"monthly"},e.prototype.step=function(){return{length:this.interval,unit:"months",seconds:2592e3*this.interval}},e.prototype.toString=function(){var a,b;return b=e.__super__.toString.call(this),a=this.interval>1?"Every "+this.interval+" months":"Every month",b&&(a+=", "+b),a},e.prototype._potentialNext=function(a,b){var c,d;return c=e.__super__._potentialNext.call(this,a,b),d=(12*b.getFullYear()+b.getMonth()-(12*c.getFullYear()+c.getMonth()))%this.interval,0===d?c:(0>d&&(d+=this.interval),new Date(c).add(d).months().set({day:1}).at({hour:0,minute:0,second:0}))},e.prototype._potentialPrevious=function(a,b){var c,d;return c=e.__super__._potentialPrevious.call(this,a,b),d=(12*b.getFullYear()+b.getMonth()-(12*c.getFullYear()+c.getMonth()))%this.interval,0===d?c:(0>d&&(d+=this.interval),new Date(c).add(d-this.interval+1).months().set({day:1}).add(-1).day().at({hour:0,minute:0,second:0}))},e.prototype._align=function(a,b){return a.getDate()===b.getDate()||this._monthdayFilters()||(a=new Date(a).set({day:1}).add(b.getDate()-1).days()),a=a.at({hour:0,minute:0,second:0}).add({hours:b.getHours(),minutes:b.getMinutes(),seconds:b.getSeconds()})},e.prototype._monthdayFilters=function(){return null!=this.filters("weekdays")||null!=this.filters("monthdays")||null!=this.filters("yeardays")||null!=this.filters("weeks")||null!=this.filters("months")},e}(Schedule.Rule)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Schedule.Rules.WeeklyRule=function(c){function e(){return this._weekdayFilters=b(this._weekdayFilters,this),this._align=b(this._align,this),this._potentialPrevious=b(this._potentialPrevious,this),this._potentialNext=b(this._potentialNext,this),this.toString=b(this.toString,this),this.step=b(this.step,this),this.freq=b(this.freq,this),this.aligned=b(this.aligned,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.aligned=function(a,b){var c,d;return c=new Date(b).add(-b.getDay()).days().at({hour:0,minute:0,second:0}),d=new Date(a).add(-a.getDay()).days().at({hour:0,minute:0,second:0}),0!==~~((c-d)/6048e5)%this.interval?!1:a.getHours()!==b.getHours()||a.getMinutes()!==b.getMinutes()||a.getSeconds()!==b.getSeconds()?!1:b.getDay()===a.getDay()||this._weekdayFilters()?!0:!1},e.prototype.freq=function(){return"weekly"},e.prototype.step=function(){return{length:this.interval,unit:"weeks",seconds:6048e5*this.interval}},e.prototype.toString=function(){var a,b;return b=e.__super__.toString.call(this),a=this.interval>1?"Every "+this.interval+" weeks":"Weekly",b&&(a+=", "+b),a},e.prototype._potentialNext=function(a,b){var c,d,f,g,h;return d=e.__super__._potentialNext.call(this,a,b),c=new Date(b).add(-b.getDay()).days().at({hour:0,minute:0,second:0}),f=new Date(d).add(-d.getDay()).days().at({hour:0,minute:0,second:0}),h=~~((c-f)/6048e5)%this.interval,0===h?d:(0>h&&(h+=this.interval),g=new Date(d).add(h).weeks(),g.add(-g.getDay()).days().at({hour:0,minute:0,second:0}))},e.prototype._potentialPrevious=function(a,b){var c,d,f,g,h;return d=e.__super__._potentialPrevious.call(this,a,b),c=new Date(b).add(-b.getDay()).days().at({hour:0,minute:0,second:0}),f=new Date(d).add(-d.getDay()).days().at({hour:0,minute:0,second:0}),h=~~((c-f)/6048e5)%this.interval,0===h?d:(0>h&&(h+=this.interval),g=new Date(d).add(h).weeks().add(-this.interval).weeks(),g.add(-g.getDay()).days().at({hour:0,minute:0,second:0}).add(1).week().add(-1).second())},e.prototype._align=function(a,b){return a.getDay()===b.getDay()||this._weekdayFilters()||(a=new Date(a).add(-a.getDay()).days().at({hour:0,minute:0,second:0}).add(b.getDay()).days()),a=new Date(a).at({hour:0,minute:0,second:0}).add({hours:b.getHours(),minutes:b.getMinutes(),seconds:b.getSeconds()})},e.prototype._weekdayFilters=function(){return null!=this.filters("weekdays")||null!=this.filters("monthdays")||null!=this.filters("yeardays")||null!=this.filters("yeardays")||null!=this.filters("weeks")||null!=this.filters("months")},e}(Schedule.Rule)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Schedule.Rules.YearlyRule=function(c){function e(){return this._monthFilters=b(this._monthFilters,this),this._dayFilters=b(this._dayFilters,this),this._align=b(this._align,this),this._potentialPrevious=b(this._potentialPrevious,this),this._potentialNext=b(this._potentialNext,this),this.toString=b(this.toString,this),this.freq=b(this.freq,this),this.aligned=b(this.aligned,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.aligned=function(a,b){return 0!==(b.getFullYear()-a.getFullYear())%this.interval?!1:a.getHours()!==b.getHours()||a.getMinutes()!==b.getMinutes()||a.getSeconds()!==b.getSeconds()?!1:a.getDate()===b.getDate()||this._dayFilters()?a.getMonth()===b.getMonth()||this._monthFilters()?!0:!1:!1},e.prototype.freq=function(){return"yearly"},e.prototype.step=function(){return{length:this.interval,unit:"years",seconds:31536e3*this.interval}},e.prototype.toString=function(){var a,b;return b=e.__super__.toString.call(this),a=this.interval>1?"Every "+this.interval+" years":"Every year",b&&(a+=", "+b),a},e.prototype._potentialNext=function(a,b){var c,d;return c=e.__super__._potentialNext.call(this,a,b),0===(b.getFullYear()-c.getFullYear())%this.interval?c:(d=(b.getFullYear()-c.getFullYear())%this.interval,0>d&&(d+=this.interval),new Date(c).add(d).years().set({month:0,day:1}))},e.prototype._potentialPrevious=function(a,b){var c,d;return c=e.__super__._potentialPrevious.call(this,a,b),0===(b.getFullYear()-c.getFullYear())%this.interval?c:(d=(b.getFullYear()-c.getFullYear())%this.interval,0>d&&(d+=this.interval),new Date(c).add(d-this.interval).years().set({month:0,day:1}))},e.prototype._align=function(a,b){var c,d;return c=this._dayFilters()?a.getDate():b.getDate(),d=this._monthFilters()?a.getMonth():b.getMonth(),a=new Date(a).set({month:0,day:1}).add(d).months().add(c-1).days(),a.at({hour:0,minute:0,second:0}).add({hours:b.getHours(),minutes:b.getMinutes(),seconds:b.getSeconds()})},e.prototype._dayFilters=function(){return null!=this.filters("weekdays")||null!=this.filters("monthdays")||null!=this.filters("yeardays")},e.prototype._monthFilters=function(){return null!=this.filters("weekdays")||null!=this.filters("yeardays")||null!=this.filters("weeks")||null!=this.filters("months")},e}(Schedule.Rule)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;Schedule.Filters.MonthdaysFilter=function(){function c(){var c;if(c=1<=arguments.length?b.call(arguments,0):[],this.toString=a(this.toString,this),this.previous=a(this.previous,this),this.next=a(this.next,this),this.step=a(this.step,this),this.match=a(this.match,this),c.length<1)throw"Specify at least one day of the month";this.monthdays=c.sort(function(a,b){return a-b})}return c.prototype.match=function(a){var b;return b=new Date(a).add(1).month().set({day:1}).add(-1).day().getDate(),this.monthdays.indexOf(a.getDate())>=0||this.monthdays.indexOf(a.getDate()-b-1)>=0},c.prototype.step=function(){return{length:1,unit:"day",seconds:86400}},c.prototype.next=function(a){for(a=new Date(a);!this.match(a);)a.add(1).day();return a},c.prototype.previous=function(a){for(a=new Date(a);!this.match(a);)a.add(-1).day();return a},c.prototype.toString=function(){var a,b;return a=_.map(this.monthdays,function(a){return""+a+"."}),b=a.pop(),a.length>0?"on "+a.join(", ")+" and "+b+" day":"on "+b+" day"},c}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;Schedule.Filters.MonthsFilter=function(){function c(){var c,d;if(d=1<=arguments.length?b.call(arguments,0):[],this.toString=a(this.toString,this),this.previous=a(this.previous,this),this.next=a(this.next,this),this.match=a(this.match,this),d.length<1)throw"Specify at least one month";this.months=function(){var a,b,e;for(e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(isNaN(parseFloat(c))?this.MONTH_NAMES[c]:c);return e}.call(this),this.months=this.months.sort()}return c.prototype.MONTH_NAMES={jan:1,january:1,feb:2,february:2,mar:3,march:3,apr:4,april:4,may:5,jun:6,june:6,jul:7,july:7,aug:8,august:8,sep:9,sept:9,september:9,oct:10,october:10,nov:11,november:11,dec:12,december:12},c.prototype.match=function(a){return this.months.indexOf(a.getMonth()+1)>=0},c.prototype.step=function(){return{length:1,unit:"month",seconds:2592e3}},c.prototype.next=function(a){var b,c,d,e,f,g;if(this.match(a))return a;for(d=null,g=this.months,e=0,f=g.length;f>e;e++)c=g[e],c>a.getMonth()+1&&(d=c);return null!=d?new Date(a).set({month:0,day:1}).add(d-1).months().at({hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()}):(b=new Date(a).set({month:0,day:1}).add(1).year().add(this.months[0]-1).months(),b.at({hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()}))},c.prototype.previous=function(a){var b,c,d,e,f,g;if(match(a))return a;for(d=null,g=this.months.reverse(),e=0,f=g.length;f>e;e++)c=g[e],c<a.getMonth()+1&&(d=c);return null!=d?(b=new Date(a).set({month:0,day:1}).add(d).months().add(-1).day(),b.at({hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()})):(b=new Date(a).set({month:0,day:1}).add(-1).year().add(this.months.last).months().add(-1).day(),b.at({hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()}))},c.prototype.toString=function(){var a,b,c;return b=[null,"January","February","March","April","May","June","July","August","September","October","November","December"],c=_.map(this.months,function(a){return b[a]}),a=c.pop(),c.length>0?"in "+c.join(", ")+" and "+a:"in "+a},c}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;Schedule.Filters.WeekdaysFilter=function(){function c(){var c,d,e,f,g;if(f=1<=arguments.length?b.call(arguments,0):[],this.toString=a(this.toString,this),this._orderInInterval=a(this._orderInInterval,this),this.previous=a(this.previous,this),this.next=a(this.next,this),this.step=a(this.step,this),this.match=a(this.match,this),f[0]instanceof Schedule.Rule&&(this.rule=f.shift()),f.length<1)throw"Specify at least one weekday";if(this.orderedWeekdays={},f[f.length-1]instanceof Object){if(null==this.rule)throw"No recurrence rule given for ordered weekdays filter";g=f[f.length-1];for(c in g)d=g[c],c=isNaN(parseFloat(c))?this.WEEKDAYS[c]:c,null==d.length&&(d=[d]),this.orderedWeekdays[this.WEEKDAY_NAMES[c]]=d.sort();f=f.slice(0,-1)}this.weekdays=function(){var a,b,c;for(c=[],a=0,b=f.length;b>a;a++)e=f[a],c.push(isNaN(parseFloat(e))?this.WEEKDAYS[e]:e);return c}.call(this),this.weekdays.sort()}return c.prototype.WEEKDAYS={su:0,sun:0,sunday:0,mo:1,mon:1,monday:1,tu:2,tue:2,tuesday:2,we:3,wed:3,wednesday:3,th:4,thu:4,thursday:4,fr:5,fri:5,friday:5,sa:6,sat:6,saturday:6},c.prototype.WEEKDAY_NAMES=["su","mo","tu","we","th","fr","sa"],c.prototype.match=function(a){var b,c,d,e,f;return this.weekdays.indexOf(a.getDay())>=0?!0:(b=this.WEEKDAY_NAMES[a.getDay()],null==this.orderedWeekdays[b]?!1:(f=this._orderInInterval(a),c=f[0],e=f[1],d=f[2],this.orderedWeekdays[b].indexOf(e)>=0||this.orderedWeekdays[b].indexOf(e-d-1)>=0))},c.prototype.step=function(){return{length:1,unit:"day",seconds:846e3}},c.prototype.next=function(a){var b;for(a=new Date(a),b=1e4;!this.match(a);){if(!(b-->0))throw"Maximum iterations reached in WeekdaysFilter.next";a.add(1).day()}return a},c.prototype.previous=function(a){var b;for(a=new Date(a),b=1e4;!this.match(a);){if(!(b-->0))throw"Maximum iterations reached in WeekdaysFilter.previous";a.add(-1).day()}return a},c.prototype._orderInInterval=function(a){var b,c,d,e,f,g,h;if(e=new Date(a).set({month:0,day:1}),this.rule instanceof Schedule.Rules.YearlyRule)d=(7+a.getDay()-e.getDay())%7+1,h=Math.ceil((a-e)/1e3/60/60/24)+1,g=~~((h-d)/7)+1,b=new Date(a).add(1).year().set({month:0,day:1}).add(-1).day(),c=Math.ceil((b-e)/1e3/60/60/24)+1,f=~~((c-d)/7)+1;else{if(!(this.rule instanceof Schedule.Rules.MonthlyRule))throw"Ordered weekdays filter only supports monthy and yearly rules. ("+this.rule["class"]+" given)";d=(7+a.getDay()-new Date(a).set({day:1}).getDay())%7+1,g=~~((a.getDate()-d)/7)+1,f=~~((new Date(a).add(1).month().set({day:1}).add(-1).day().getDate()-d)/7)+1}return[d,g,f]},c.prototype.toString=function(){var a,b,c,d,e,f=this;return a=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],e=_.map(this.weekdays,function(b){return a[b]}),d=_.map(this.orderedWeekdays,function(b,c){return""+_.map(b,function(a){return""+a+"."}).join(", ")+" "+a[f.WEEKDAYS[c]]}),b=e.concat(d),c=b.pop(),b.length>0?"on "+b.join(", ")+" and "+c:"on "+c},c}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;Schedule.Filters.YeardaysFilter=function(){function c(){var c;if(c=1<=arguments.length?b.call(arguments,0):[],this.toString=a(this.toString,this),this.yearDay=a(this.yearDay,this),this.previous=a(this.previous,this),this.next=a(this.next,this),this.step=a(this.step,this),this.match=a(this.match,this),c.length<1)throw"Specify at least one day of the month";this.yeardays=c.sort()}return c.prototype.match=function(a){var b,c;return b=new Date(a).set({month:0,day:1}).add(1).year().add(-1).day(),c=this.yearDay(b),this.yeardays.indexOf(this.yearDay(a))>=0||this.yeardays.indexOf(this.yearDay(a)-c-1)>=0},c.prototype.step=function(){return{length:1,unit:"day",seconds:86400}},c.prototype.next=function(a){for(a=new Date(a);!this.match(a);)a.add(1).day();return a},c.prototype.previous=function(a){for(a=new Date(a);!this.match(a);)a.add(-1).day();return a},c.prototype.yearDay=function(a){var b;return a=new Date(a),b=new Date(a).set({month:0,day:1}),Math.ceil((a-b)/864e5)+1},c.prototype.toString=function(){var a,b;return a=_.map(this.yeardays,function(a){return""+a+"."}),b=a.pop(),a.length>0?"on "+a.join(", ")+" and "+b+" day":"on "+b+" day"},c}()}.call(this),function(){Schedule.Suboccurrence=function(){function a(a){this.start=a.start,this.end=a.end,this.isOccurrenceStart=a.isOccurrenceStart,this.isOccurrenceEnd=a.isOccurrenceEnd}return a}(),Schedule.Suboccurrence.find=function(a){var b,c,d;if(null==(c=a.occurrence).length)throw"Missing occurrence";if(null==(b=a.interval).length)throw"Missing interval";return c[1]<=b[0]||c[0]>=b[2]?null:(d={},c[0]<b[0]?(d.start=b[0],d.isOccurrenceStart=!1):(d.start=c[0],d.isOccurrenceStart=!0),c[1]>b[1]?(d.end=b[1],d.isOccurrenceEnd=!1):(d.end=c[1],d.isOccurrenceEnd=!0),new Schedule.Suboccurrence(d))}}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Schedule.Occurrence=function(){function b(b,c){this._initLoop=a(this._initLoop,this),this._listOccurrences=a(this._listOccurrences,this),this.toObject=a(this.toObject,this),this.all=a(this.all,this),this.suboccurrencesBetween=a(this.suboccurrencesBetween,this),this.occurrencesBetween=a(this.occurrencesBetween,this),this.previousOccurrences=a(this.previousOccurrences,this),this.previousOccurrence=a(this.previousOccurrence,this),this.nextOccurrences=a(this.nextOccurrences,this),this.nextOccurrence=a(this.nextOccurrence,this),this.rule=b,this.startTime=this.rule.match(c,c)?c:this.rule.next(c,c)}return b.prototype.nextOccurrence=function(a){return this.nextOccurrences(1,a)[0]},b.prototype.nextOccurrences=function(a,b){var c;return null!=this.rule.stop()&&b>this.rule.stop()?[]:(c=b<=this.startTime?this.startTime:b,this.rule.match(c,this.startTime)||(c=this.rule.next(c,this.startTime)),this._listOccurrences(c,function(){return(a-=1)>=0}))},b.prototype.previousOccurrence=function(a){return this.previousOccurrences(1,a)[0]},b.prototype.previousOccurrences=function(a,b){var c;return b<=this.startTime?[]:(c=null==this.rule.stop()||b<this.rule.stop()?b:this.rule.stop(),c=this.rule.previous(c,this.startTime),this._listOccurrences(c,"back",function(){return(a-=1)>=0}).reverse())},b.prototype.occurrencesBetween=function(a,b){var c;if(!(b>a))throw"Empty time interval";return b<=this.startTime||null!=this.rule.stop()&&a>=this.rule.stop()?[]:(c=a<=this.startTime?this.startTime:a,this.rule.match(c,this.startTime)||(c=this.rule.next(c,this.startTime)),this._listOccurrences(c,function(a){return b>a}))},b.prototype.suboccurrencesBetween=function(a,b){var c,d,e,f,g;for(d=this.occurrencesBetween(new Date(a-this.duration),b),g=[],e=0,f=d.length;f>e;e++)c=d[e],g.push(Schedule.Suboccurrence.find({occurrence:[c,new Date(+c+this.duration)],interval:[a,b]}));return g},b.prototype.all=function(){var a,b;return null!=this.rule.stop()?(b=this.rule,this._listOccurrences(this.startTime,function(a){return a<b.stop()})):(a=this.rule.count(),this._listOccurrences(this.startTime,function(){return(a-=1)>=0}))},b.prototype.toObject=function(){return this.rule.toObject()},b.prototype._listOccurrences=function(a,b,c){var d,e,f,g,h,i;if(!this.rule.match(a,this.startTime))throw"From "+a+" not matching the rule "+this.rule+" and start time "+this.startTime;for(null!=c?f=b:(f="forward",c=b),h=[],i=this._initLoop(a,f),g=i[0],e=i[1],d=1e4;;){if(!(d-->0))throw"Maximum iterations reached when listing occurrences...";if(!(e>=this.startTime&&(null==this.rule.stop()||e<this.rule.stop())&&(null==this.rule.count()||(g-=1)>=0)))return h;if(!c(e))return h;h.push(e),e="forward"===f?this.rule.next(e,this.startTime):this.rule.previous(e,this.startTime)}},b.prototype._initLoop=function(a,b){var c,d;if(null==this.rule.count())return[0,a];if("forward"===b){for(d=0,c=this.startTime;a>c;)d+=1,c=this.rule.next(c,this.startTime);return[this.rule.count()-d,c]}for(d=0,c=this.startTime;a>c&&(d+=1)<this.rule.count();)c=this.rule.next(c,this.startTime);return[this.rule.count(),c]},b}()}.call(this);